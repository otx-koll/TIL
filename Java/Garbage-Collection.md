# 가비지 컬렉션(GC, Garbage Collection)

메모리 관리 방법 중 하나로 프로그램이 동적으로 할당했던 메모리 영역 중에서 필요없게 된 메모리 영역을 해제하는 기능이다. 

여기서 필요없게 된 메모리 영역은 어떤 변수도 가리키지 않게 된 영역을 의미한다.

## 장점

쓰레기 수집이 지원되는 환경에서는 개발자가 관리하지 않아도 된다. 쓰레기 수집은 아래와 같은 버그를 줄이거나 막을 수 있다.

- 유효하지 않은 포인터 접근 : 이미 해제된 메모리에 접근하는 버그
- 이중 해제 : 이미 해제된 메모리를 또다시 해제하는 버그
- 메모리 누수 : 더이상 필요하지 않은 메모리가 해제되지 않고 남아 있는 버그. 메모리 누수가 반복되면 메모리 고갈로 프로그램이 중단될 수 있다.

## 단점

- 어떤 메모리를 해제할지 결정하는 데에 비용이 든다. 메모리 해제 시점을 추적해야 하므로 이것은 오버헤드가 된다.
- 가비지가 수집되는 타이밍을 예측할 수 없다.
- 할당된 메모리가 해제되는 시점을 알 수 없다. 

## 가비지 컬렉션 대상

가비지 컬렉션은 특정 객체가 가비지인지 아닌지 판단한기 위해 도달능력(Reachability)이라는 개념을 적용한다.

객체에 레퍼런스가 있으면 Reachable로 구분하고, 객체에 유효한 레퍼런스가 없다면 Unreachable로 구분한다.

- Reachable : 객체가 참조되고 있는 상태
- Unreachable : 객체가 참조되고 있지 않은 상태 (GC의 대상이 됨)

## 방식

### Mark and sweep

- Mark : 먼저 Root Space로부터 그래프 순회를 통해 연결된 객체들을 찾아내어 각각 어떤 객체를 참조하고 있는지 찾아서 마킹한다.
- Sweep : 참조하고 있지 않은 객체 즉 Unreachable 객체들을 Heap에서 제거한다.
- Compact : Sweep 후에 분산된 객체들을 Heap의 시작 주소로 모아 메모리가 할당된 부분과 그렇지 않은 부분으로 압축한다. (가비지 컬렉터 종류에 따라 하지 않는 경우도 있음)

### Reference

https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)